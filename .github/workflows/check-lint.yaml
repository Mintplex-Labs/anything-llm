# This GitHub action is for ensuring that `yarn lint` is run on all 
# files to normalize code formatting across the project.
name: Check lint

concurrency:
  group: build-${{ github.ref }}
  cancel-in-progress: true

on:
  pull_request:
    types: [opened, synchronize, reopened]
    paths-ignore:
      - '**.md'
      - 'cloud-deployments/*'
      - 'images/**/*'
      - '.vscode/**/*'
      - '**/.env.example'
      - '.github/ISSUE_TEMPLATE/**/*'
      - '.devcontainer/**/*'
      - 'embed/**/*' 
      - 'browser-extension/**/*'
      - 'server/utils/agents/aibitat/example/**/*'

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Setup dependencies
        run: |
          npm install -g prettier@^3.0.3
          echo "Prettier installed"

      - name: Run lint checks
        run: |
          echo "Running lint checks"
          echo "Current directory: $(pwd)"
          cat .prettierignore

          # Server lint check
          cd server
          npm run lint:check
          cd ..
          echo "Current directory: $(pwd)"

          # Frontend lint check
          cd frontend
          npm run lint:check
          cd ..
          echo "Current directory: $(pwd)"

          # Collector lint check
          cd collector
          npm run lint:check
          cd ..
          echo "Current directory: $(pwd)"

      - name: Fail job on error
        if: failure()
        run: exit 1
